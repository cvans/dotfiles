{{ if eq .chezmoi.os "linux" -}}
{{ if eq .chezmoi.osRelease.id "arch" -}}
#!/usr/bin/env bash

set -euo pipefail

echo "Starting keyd setup..."

KEYD_SOURCE_FILE="{{ .chezmoi.sourceDir }}/root/etc/keyd/default.conf"
KEYD_DEST_FILE="/etc/keyd/default.conf"

if [[ ! -f "$KEYD_SOURCE_FILE" ]]; then
  echo "Error: Source file '$KEYD_SOURCE_FILE' not found."
  exit 1
fi

echo "Copying $KEYD_SOURCE_FILE to $KEYD_DEST_FILE ..."

sudo cp "$KEYD_SOURCE_FILE" "$KEYD_DEST_FILE"

echo "Finished keyd configuration install..." 

echo "Enabling and starting keyd service..."
sudo systemctl enable --now keyd

echo "Finished keyd setup..."
{{ end -}}
{{ end -}}

