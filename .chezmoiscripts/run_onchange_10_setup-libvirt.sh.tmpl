{{ if eq .chezmoi.os "linux" -}}
{{ if eq .chezmoi.osRelease.id "arch" -}}
#!/usr/bin/env bash

set -euo pipefail

echo "Adding current user to libvirt group..."

if ! getent group libvirt >/dev/null; then
  echo "Creating libvirt group..."
  sudo groupadd libvirt
fi

if id -nG "$USER" | grep -qw libvirt; then
  echo "User $USER is already in libvirt group. Nothing to do."
else
  sudo usermod -aG libvirt "$USER"
  echo "User $USER added to libvirt group..."
  echo "⚠️ Please log out and back in (or restart your session) for changes to take effect..."
fi

echo "Completed libvirt setup..."
{{ end -}}
{{ end -}}

